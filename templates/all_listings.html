{% extends "base.html" %}

{% block title %}All Listings{% endblock %}

{% block content %}
<h2>All Listings</h2>

<!-- Filter form -->
<form method="get" action="{{ url_for('listings.all_listings') }}">
    <label for="category">Category:</label>
    <select name="category" id="category">
        <option value="All" {% if selected_category == 'All' %}selected{% endif %}>All</option>
        <option value="Furniture" {% if selected_category == 'Furniture' %}selected{% endif %}>Furniture</option>
        <option value="Electronic" {% if selected_category == 'Electronic' %}selected{% endif %}>Electronic</option>
        <option value="Other" {% if selected_category == 'Other' %}selected{% endif %}>Other</option>
    </select>

    <label for="search">Search:</label>
    <input type="text" name="search" id="search" value="{{ search }}">

    <button type="submit">Filter</button>
</form>

<hr>

<!-- Listings -->
{% for listing in listings %}
    <div class="listing">
        <h3>{{ listing[1] }} - ${{ listing[2] }}</h3>
        <p><strong>Category:</strong> {{ listing[3] }}</p>
        <p><strong>Description:</strong> {{ listing[4] }}</p>
        <p><strong>Seller:</strong> {{ listing[6] }}</p>
        {% if listing[5] %}
            <img src="{{ url_for('static', filename=listing[5]) }}" alt="Image" width="200">
        {% endif %}
        <br>

        {% if listing[7] %}
            <p><strong>Status:</strong> Purchased</p>
        {% elif listing[8] == session.get('user_id') %}
            <p><em>This is your listing.</em></p>
            <form action="{{ url_for('listings.delete_listing', listing_id=listing[0]) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this listing?');">
                <button type="submit" class="delete-btn">Delete</button>
            </form>
        {% else %}
            <form action="{{ url_for('listings.purchase_item', listing_id=listing[0]) }}" method="POST">
                <button type="submit">Purchase</button>
            </form>
        {% endif %}
    </div>
    <hr>
{% endfor %}
{% endblock %}

